<!DOCTYPE html>
<html>
    <head>
        <title>NuCompRes HTML5 Advanced Example</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <style>
            
        form {
            margin: 1em;
        }
        
        fieldset {
            padding: 1em;
        }
        
        legend {
            margin: 1ex;
            font-size: x-large;
        }
            
        label {
            display: block;
            width:30em;
            clear:both;
        }
        
        input {
            width:10em;
            float:right;
        }
        
        textarea {
            width:25em;
            height:7em;
        }
        
        button {
            margin: 1ex;
        }
        </style>
        
        <script src="MultiPart_parse.js"></script>
        <script>



function submitMultiPart(method, url, requestFields, callback) {
    if ( !window.FormData) alert('Your browser, most likely being pretty outdated, does not support FormData.');

    var acceptElem = document.getElementById('AcceptContentType');
    var accept = acceptElem.options[acceptElem.options.selectedIndex].innerHTML;
    
    // See https://developer.mozilla.org/en-US/docs/Web/API/FormData
    var formData = new FormData();
    var i, id;
    
    for (i=0; i<requestFields.length; i++) {
        id = requestFields[i];
        formData.append(id, document.getElementById(id).value);
    }
        
    var xhr = new XMLHttpRequest();
    xhr.onload = function() {
        if ( xhr.status != 200 ) {
            alert(xhr.responseText);
            return;
        }
        var ct = xhr.getResponseHeader('Content-Type').replace(/;.*/, '');
        if ( ct == "text/plain" ) {
            callback(xhr.responseText);
        } else if ( ct == "multipart/form-data") {
            var responseFields = MultiPart_parse(xhr.responseText, xhr.getResponseHeader('Content-Type'));
            callback(responseFields);
        } else if ( ct == 'application/json' ) {
            callback(JSON.parse(xhr.responseText));
        }
    };

    xhr.open(method, url);
    xhr.setRequestHeader("Accept", accept);
    xhr.send(formData);
}

function submitEval() {
    submitMultiPart('POST', '/eval',
        ['expression'],
        function(responseFields) {
            document.getElementById('ans').value = JSON.stringify(responseFields, null, 2);
        }
    )
}

function submitPricing() {
    submitMultiPart('POST', '/pricer/options/american',
        ['S', 'E', 'T', 'r', 'sigma'],
        function(responseFields) {
            document.getElementById('fairPrice').innerHTML = responseFields.fairValue;
        }
    )
}

function submitStop() {
    submitMultiPart('POST', '/admin/stop',
        [],
        function(responseFields) {
            alert(JSON.stringify(responseFields));
        }
    )
}
        </script>
            
    </head>

    <body>

    <h1>NuCompRes HTML5 Form Example</h1>
    
    <p>
        HTML5 Ajax style submits, no page transitions. Accepted Content Type for all requests:
        <select id="AcceptContentType">
            <option>application/json</option>
            <option>multipart/form-data</option>
        </select>
    <p>
    
    <fieldset>
        <legend>Evaluate MATLAB Expressions</legend>
        <p>
            <label>Expression</br><textarea id="expression">% Solve Ax=b
A = [1 -2;-3 4];
b = [2; 1];
response.x = A \ b;
</textarea></label>
            <textarea id="ans"></textarea>
        </p>    
        <button onclick="submitEval()">Eval</button>
    </fieldset>

    <fieldset>
        <legend>American Option Pricing</legend>
        <label>asset starting price S<input id="S" value="9"/></label>
        <label>exercise price E<input id="E" value="10"/></label>
        <label>expiry time T<input id="T" value="1"/></label>
        <label>risk-free interest rate r<input id="r" value="0.06"/></label>
        <label>volatility sigma<input id="sigma" value="0.3"/></label>
        <button onclick="submitPricing()">Price</button>
        
        <p>
            The Fair Price is <span id="fairPrice" style="font-weight:bold">...</span>
        </p>
    </fieldset>
    
    <fieldset>
        <legend>Stop Server</legend>
        <button onclick="submitStop()">Stop Now</button>
    </fieldset>
    
    </body>
</html>